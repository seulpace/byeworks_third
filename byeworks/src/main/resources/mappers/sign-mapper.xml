<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
				 "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
				 
<mapper namespace="signMapper">


	<resultMap type="Department" id="departmentResultSet">
		<id property="departmentNo" column="DEPARTMENT_NO" />
		<result property="departmentName" column="DEPARTMENT_NAME" />
	</resultMap>
	
	<resultMap type="Member" id="memberResultSet">
		<!-- property : vo클래스의 필드명 / column : DB조회된 컬럼명 -->
		<id property="memberNo" column="member_no" />
		<result property="memberId" column="member_id" />
		<result property="memberName" column="member_name" />
		<result property="memberPwd" column="member_pwd" />
		<result property="position" column="position" />
		<result property="department" column="department" />
		<result property="phone" column="phone" />
		<result property="extension" column="extension" />
		<result property="email" column="email" />
		<result property="address" column="address" />
		<result property="birth" column="birth" />
		<result property="enrollday" column="enrollday" />
		<result property="memberStatus" column="member_status" />
		<result property="retireday" column="retireday" />
		<result property="profileModify" column="profile_modify" />
		<result property="empNo" column="empno" />
	</resultMap>
	
	<resultMap type="SignDto" id="signDtoResultSet">
		<id property="signNo" column="SIGN_NO" />
		<result property="signUpDate" column="SIGNUP_DATE" />
		<result property="docuType" column="D_TYPE" />
		<result property="memberName" column="MEMBER_NAME" />
		<result property="signStatus" column="SIGN_STATUS" />
		<result property="flag" column="FLAG" />
		<result property="title" column="TITLE" />
		<result property="memberNo" column="MEMBER_NO" />
	</resultMap>
	
	

	
	
	<select id="selectDepartmentList" resultMap="departmentResultSet">
	
		SELECT DEPARTMENT_NO, DEPARTMENT_NAME FROM TB_DEPARTMENT
	</select>
	
	<select id="selectEmpList" parameterType="_int" resultMap="memberResultSet">
	
		SELECT MEMBER_NO, MEMBER_ID, MEMBER_NAME, POSITION, DEPARTMENT, EMPNO FROM TB_MEMBER WHERE DEPARTMENT = #{departmentNo} AND MEMBER_STATUS ='Y' ORDER BY POSITION
	</select>
	
	<insert id="insertSignA" parameterType="SignAndAnnualSign">
	
		INSERT INTO TB_SIGN VALUES
		(SEQ_SNO.NEXTVAL, SYSDATE, #{docuType}, DEFAULT, DEFAULT, #{title}, #{memberNo})
	
	</insert>
	
	<insert id="insertAnnualSign" parameterType="SignAndAnnualSign">
		INSERT INTO TB_ANNUAL_SIGN VALUES
		(SEQ_SNO.CURRVAL, SYSDATE, #{annualPeriod}, #{annualStartDay}, #{annualEndDay}, #{annualContent}, #{annualType})
	
	</insert>
	
	<insert id="insertSignLine" parameterType="list">
		INSERT ALL
		<foreach collection="list" item="item" separator=" ">
			INTO TB_SIGNLINE VALUES
			(#{item.signLineMemberNo}, SEQ_SNO.CURRVAL, NULL, DEFAULT, #{item.memberOrder})
		</foreach>
		SELECT * FROM DUAL
	</insert>
	
	<insert id="insertSignRefer" parameterType="list">
		INSERT ALL
		<foreach collection="list" item="item" separator=" ">
			INTO TB_SIGNREFER VALUES
			(SEQ_SNO.CURRVAL, #{item.referMemberNo}, DEFAULT, NULL )
		</foreach>
		SELECT * FROM DUAL
	
	</insert>
	
	<insert id="insertSignAttachment" parameterType="SignAttachment">
		INSERT INTO TB_SIGN_ATTACHMENT VALUES
		(SEQ_FNO.NEXTVAL, #{oaName}, #{maName}, NULL, SEQ_SNO.CURRVAL)
	
	</insert>
	
	<insert id="insertSignQ" parameterType="SignAndQuit">
		INSERT INTO TB_SIGN VALUES
		(SEQ_SNO.NEXTVAL, SYSDATE, #{docuType}, DEFAULT, DEFAULT, #{title}, #{memberNo})
	</insert>
	
	<insert id="insertQuit" parameterType="SignAndQuit">
		INSERT INTO TB_QUIT VALUES
		(SEQ_SNO.CURRVAL, #{enrollDate}, #{quitDate}, #{reason})
	
	</insert>
	
	<insert id="insertSignLineList" parameterType="list">
		INSERT ALL 
		<foreach collection="list" item="item" separator=" ">
			INTO TB_SIGNLINE VALUES
			(#{item.signLineMemberNo}, SEQ_SNO.CURRVAL, NULL, DEFAULT, #{item.memberOrder})
		</foreach>
		SELECT * FROM DUAL
	</insert>
	
	<insert id="insertReferList" parameterType="list">
		INSERT ALL
		<foreach collection="list" item="item" separator=" ">
			INTO TB_SIGNREFER VALUES
			(SEQ_SNO.CURRVAL, #{item.referMemberNo}, DEFAULT, NULL)
		</foreach>
		SELECT * FROM DUAL
	</insert>
	
	<insert id="insertAttachmentList" parameterType='SignAttachment'>
		INSERT INTO TB_SIGN_ATTACHMENT VALUES
		(SEQ_FNO.NEXTVAL, #{oaName}, #{maName}, NULL, SEQ_SNO.CURRVAL)
	</insert>
	
	<insert id="insertSignAp" parameterType="SignAndAppointment">
		INSERT INTO TB_SIGN VALUES
		(SEQ_SNO.NEXTVAL, SYSDATE, #{docuType}, DEFAULT, DEFAULT, #{title}, #{memberNo})
	</insert>
	
	<insert id="insertAppointment" parameterType="SignAndAppointment">
		INSERT INTO TB_APPOINTMENT VALUES
		(SEQ_SNO.CURRVAL, #{positionBefore}, #{positionAfter}, #{depBefore}, #{depAfter}, #{appointmentLev}, #{appointmentMem}, #{appointmentDate})
	</insert>
	
	<select id="selectSignList" parameterType="hashmap" resultMap="signDtoResultSet">
	SELECT SIGN_NO, SIGNUP_DATE, D_TYPE, SIGN_STATUS, FLAG, TITLE, MEMBER_NO, MEMBER_NAME FROM TB_SIGN JOIN TB_MEMBER USING(MEMBER_NO)
	WHERE MEMBER_NO = #{memberNo}
	
	<if test="type == 1">
		AND FLAG ='Y'
	</if>
	
	<if test="type == 2">
		AND FLAG ='N' AND SIGN_STATUS = 'O'
	</if>

	<if test="type == 3">
		AND FLAG ='Y' AND SIGN_STATUS = 'O'
	</if>

	<if test="type == 4">
		AND FLAG = 'Y' AND SIGN_STATUS = 'C'
	</if>

	<if test="type == 5">
		AND FLAG = 'Y' AND SIGN_STATUS = 'R'
	</if>
	
	<if test="type == 6">
		AND FLAG = 'N' AND SIGN_STATUS = 'D'
	</if>

	</select>
	
	
	

	







</mapper>				 